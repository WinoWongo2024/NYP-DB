<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NYP / ÖestVèl CID Secure Operations Terminal</title>
    <!-- PWA Setup -->
    <meta name="theme-color" content="#1e2d40">
    <link rel="apple-touch-icon" href="icon-192.png"> 
    
    <style>
        /* --- MODERN TERMINAL STYLE REFACTOR --- */
        :root {
            --color-bg: #0c151e; /* Darker background */
            --color-terminal: #1a293a; /* Slightly lighter panel */
            --color-accent: #ffc107; /* Amber/Yellow for primary focus */
            --color-success: #43e061; /* Brighter Green for active/access granted */
            --color-error: #ff5555; /* Crisper Red for denied/critical */
            --color-text: #f0f8ff;
            --color-mono: 'Roboto Mono', 'Consolas', monospace; /* Modern, clean monospace */
            --touch-padding: 15px; 
            --neon-glow: 0 0 5px rgba(255, 193, 7, 0.7), 0 0 10px rgba(255, 193, 7, 0.3);
        }

        body {
            font-family: var(--color-mono);
            background-color: var(--color-bg);
            color: var(--color-text);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent; 
        }

        /* HEADER & FOOTER */
        header {
            background-color: var(--color-terminal);
            padding: 15px 0;
            text-align: center;
            border-bottom: 3px solid var(--color-accent);
            position: relative; 
            padding-right: 100px; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        header h1 {
            color: var(--color-accent);
            margin: 0;
            font-size: 1.5em;
            text-shadow: var(--neon-glow);
        }

        header h2 {
            color: var(--color-text);
            margin: 5px 0 0 0;
            font-size: 0.9em;
            font-weight: normal;
        }

        /* Logo Base Style (Centered for PIN Screen) */
        .logo {
            width: 80px; /* NEW SIZE: Clearer for central display */
            height: 80px;
            margin-bottom: 10px;
            object-fit: contain; /* Ensure image fits neatly */
            /* Initial 'offline' state: Grayscale with a light glow */
            filter: grayscale(100%) brightness(150%); 
            transition: all 0.5s ease;
            border-radius: 4px;
        }

        /* NEW: Top Right Positioning for Logged-In Screens (PWA size) */
        .logo-top-right {
            position: absolute;
            top: 5px;
            right: 15px;
            width: 55px; /* NEW SIZE: Optimized small size for corner */
            height: 55px;
            margin: 0;
            border: 1px solid var(--color-accent);
            padding: 3px;
            background-color: var(--color-bg);
            border-radius: 4px;
            filter: none; /* Remove filter for active system state */
            box-shadow: var(--neon-glow);
        }

        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 5px 0;
            background-color: var(--color-terminal);
            color: var(--color-success);
            font-size: 0.75em;
            text-align: center;
            border-top: 1px solid var(--color-success);
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.4);
            z-index: 100;
            transition: color 0.3s;
        }

        /* UTILITIES & SCREENS */
        .hidden { display: none !important; }
        .error { color: var(--color-error); font-weight: bold; }
        .status-active { color: var(--color-success); }
        .status-closed { color: var(--color-error); }
        .status-unconfirmed { color: var(--color-accent); }
        
        .terminal-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 85vh;
            padding: 20px;
        }
        .terminal-box {
            background-color: var(--color-terminal);
            padding: 30px 20px;
            border: 2px solid var(--color-accent);
            border-radius: 8px;
            text-align: center;
            box-shadow: var(--neon-glow);
            width: 90%;
            max-width: 400px;
        }

        /* INPUTS & BUTTONS */
        input[type="text"], input[type="password"] {
            padding: 14px;
            margin: 10px 0 20px 0;
            border: 1px solid #4a5c6e;
            background-color: var(--color-bg);
            color: var(--color-success);
            width: 90%;
            box-sizing: border-box;
            text-align: center;
            border-radius: 4px;
            font-size: 1.1em;
            text-shadow: 0 0 2px var(--color-success);
        }
        button {
            background-color: var(--color-success);
            color: var(--color-bg);
            padding: var(--touch-padding);
            border: none;
            cursor: pointer;
            font-weight: bold;
            margin: 8px 0;
            width: 100%;
            border-radius: 4px;
            transition: background-color 0.3s, box-shadow 0.2s;
            text-transform: uppercase;
        }
        button:hover, button:focus {
            background-color: #3cb055;
            box-shadow: 0 0 10px var(--color-success);
        }
        .back-button, .close-file-button {
            background-color: var(--color-error);
        }
        .back-button:hover, .close-file-button:hover {
             background-color: #d13d3d;
             box-shadow: 0 0 10px var(--color-error);
        }
        
        /* LAYOUTS */
        .case-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        .case-card, .record-card {
            background-color: var(--color-terminal);
            border: 1px solid var(--color-accent);
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            border-radius: 6px;
            box-shadow: 0 0 5px rgba(255, 193, 7, 0.1);
        }
        .case-card:hover, .record-card:hover {
            border-color: var(--color-success);
            box-shadow: 0 0 8px var(--color-success);
        }
        
        /* VIEWER & CONTENT */
        .file-viewer {
            padding-bottom: 50px;
            padding-top: 15px;
        }
        .file-header {
            display: flex;
            flex-direction: column; 
            background-color: #2a3c50;
            padding: 10px;
            border-bottom: 2px solid var(--color-accent);
            margin-bottom: 15px;
            gap: 10px;
        }
        .log-entry {
            border-bottom: 1px dashed #4a5c6e;
            padding: 8px 0;
            font-size: 0.85em;
            display: flex;
            justify-content: space-between;
        }
        
        /* Media Query for larger screens (e.g., tablet/desktop) */
        @media (min-width: 768px) {
            .case-grid { grid-template-columns: repeat(3, 1fr); }
            .file-header { flex-direction: row; justify-content: space-between; align-items: center;}
            .close-file-button { width: auto; margin: 0; }
        }
    </style>
</head>
<body>

    <header id="main-header">
        <!-- Logo Source updated to use the root path: IMG_0749.png -->
        <img id="nyp-logo" src="IMG_0749.png" alt="NYP/Velic Crown Logo" class="logo">
        <h1>NYP / ÖestVèl CID</h1>
        <h2 id="screen-title">SECURE OPERATIONS TERMINAL</h2>
    </header>

    <!-- LAYER 1: SYSTEM ACCESS (PIN) -->
    <div id="terminal-access" class="terminal-screen">
        <div class="terminal-box">
            <p class="system-title">SYSTEM INITIATION PROTOCOL</p>
            <hr style="border-color: #4a5c6e;">
            <p>ENTER DCI SYSTEM ACCESS PIN</p>
            <label for="system-code">PIN (7 Digits):</label>
            <input type="password" id="system-code" maxlength="7" placeholder="_______" onkeyup="window.checkTerminalCode(event)">
            <p id="terminal-message" class="error"></p>
        </div>
    </div>

    <!-- LAYER 2: MAIN MENU / CASE INDEX -->
    <div id="main-menu" class="file-viewer hidden">
        <div class="file-header">
            <h3 style="color:var(--color-accent); margin:0;">MAIN MENU &rarr; INVESTIGATIONS</h3>
            <div style="display:flex; gap: 10px; flex-wrap: wrap;">
                <button onclick="window.showRecordsTerminal()" style="flex-grow:1;">SUSPECT RECORDS</button>
                <button onclick="window.showAuditLogTerminal()" style="flex-grow:1;">AUDIT LOG</button>
                <button class="close-file-button" onclick="window.logOutUser()" style="flex-grow:1;">LOGOUT</button>
            </div>
        </div>
        <main class="case-grid" id="case-grid">
            <!-- Case buttons will be injected here by script.js -->
        </main>
    </div>

    <!-- LAYER 3: SUSPECT RECORDS TERMINAL -->
    <div id="records-terminal" class="file-viewer hidden">
        <div class="file-header">
            <h3 style="color:var(--color-accent); margin:0;">MAIN MENU &rarr; SUSPECT/PERSONS RECORDS (PINS)</h3>
            <button class="back-button-top" onclick="window.showMainMenu()">BACK TO MENU</button>
        </div>
        <main class="case-grid" id="records-grid">
            <!-- Records will be injected here -->
        </main>
    </div>

    <!-- LAYER 4: AUDIT LOG TERMINAL -->
    <div id="audit-log-terminal" class="file-viewer hidden">
        <div class="file-header">
            <h3 style="color:var(--color-accent); margin:0;">MAIN MENU &rarr; SYSTEM AUDIT LOG</h3>
            <button class="back-button-top" onclick="window.showMainMenu()">BACK TO MENU</button>
        </div>
        <div style="padding: 0 20px;" id="audit-log-content">
            <!-- Logs will be injected here -->
        </div>
    </div>

    <!-- LAYER 5: CASE FILE VIEWER -->
    <div id="case-file-viewer" class="file-viewer hidden"> 
        <div class="file-header">
            <div class="ref-block">
                <p>Case Reference: <span id="file-ref-display" class="status-active"></span></p>
                <p>Status: <span id="file-status-display" class="status-active"></span></p>
            </div>
            <div class="officer-block">
                <p>Investigating Officer: <span id="file-officer-display"></span></p>
                <p>Time (OVST): <span id="current-time"></span></p>
            </div>
            <button class="close-file-button" onclick="window.showMainMenu()">CLOSE FILE</button>
        </div>
        <section style="padding: 0 20px;" id="file-content">
            <!-- Case content loaded dynamically here -->
        </section>
    </div>
    
    <footer>
        <p>CONFIDENTIAL | SYSTEM LOG: <span id="system-log">SYSTEM OFFLINE. AWAITING DCI PIN.</span></p>
    </footer>

    <!-- Firebase Imports (MUST use type="module" for ES6 modules) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, query, serverTimestamp, orderBy, limit, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- GLOBAL CONFIG & INITIALIZATION ---
        const SYSTEM_PIN = "1936203"; // DCI System Access PIN (19:36 BST / 20:36 CEST for the OD)
        const CASE_PASSWORDS = {
            "PROXY-001": "MILLIE66", 
            "VELIC-002": "TRANSF3R" 
        };

        let db, auth, userId;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let casesCollectionRef, suspectsCollectionRef, logCollectionRef;
        let allCases = [];
        let allSuspects = [];
        let auditLog = [];

        // --- DATA TEMPLATES ---
        const initialCaseData = {
            "PROXY-001": {
                ref: "PROXY-001",
                name: "Operation Proxy",
                officer: "DCI Jess.W",
                opened: "02/11/2025 – 15:00 hrs OVST",
                location: "Scarborough, ÖestVèl",
                status: "Active",
                sections: [
                    { title: "1. Background", content: `<p>Subject of investigation: <strong>“Millie”</strong> – known associate, previously engaged in private Snapchat communications with Investigator.</p><p>Trigger event: Emergence of a new Snapchat account (alias: <strong>izzy_scuzzy</strong>) following breakdown of trust and prior account irregularities.</p>` },
                    { title: "3. Evidence Collected", content: `
                        <h4>3.1 Snapchat Activity</h4><ul><li>New account identified (izzy_scuzzy).</li></ul>
                        <h4>3.2 Image Comparisons</h4><ul><li>Image 1 & 2: <strong>Confirmed Millie.</strong> <a href="./evidence/proxy-001/snap-1.jpg" target="_blank" class="evidence-link">[VIEW EVID-SN1]</a></li>
                        <li>Image 3 (Insta): Strong resemblance but structural differences. <a href="./evidence/proxy-001/insta-3.jpg" target="_blank" class="evidence-link">[VIEW EVID-IN3]</a></li></ul>
                        <h4>3.3 Facial Recognition Analysis</h4><ul><li><strong>Verdict:</strong> Instagram subject <strong>not confirmed</strong> as Millie (&lt;80% threshold).</li></ul>
                    `},
                ]
            }
        };

        const initialSuspectsData = {
            "Millie-001": {
                name: "Millie K.",
                alias: "izzy_scuzzy (Snapchat)",
                status: "Person of Interest (POI)",
                ref: "PID-MK-001",
                notes: "Primary subject of Operation Proxy. Identity confirmed on private snaps. Instagram alias identity unconfirmed.",
                currentLocation: "Confirmed: Harrogate area (ÖestVèl Centrè)",
                linkedCases: ["PROXY-001"]
            }
        };


        // --- AUTH & FIRESTORE SETUP ---

        async function initializeFirebaseAndListeners() {
            if (!firebaseConfig) {
                console.error("Firebase config is missing.");
                return;
            }
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            // 1. Authenticate
            try {
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (e) {
                console.error("Authentication failed:", e);
                updateSystemLog('CRITICAL: Auth Failure.', true);
                return;
            }

            // Wait for auth state to be resolved
            await new Promise(resolve => onAuthStateChanged(auth, user => {
                if (user) {
                    userId = user.uid;
                    // Define Firestore references using userId
                    casesCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/cases`);
                    suspectsCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/suspects`);
                    logCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/audit_log`);
                    updateSystemLog(`Auth OK: User ${user.uid.substring(0, 8)}... Initializing Data.`, false);
                    resolve();
                } else {
                    updateSystemLog('CRITICAL: User Not Authenticated.', true);
                    resolve();
                }
            }));

            // 2. Initialize Data
            await initializeDefaultData();
            
            // 3. Start real-time listeners (Instant Updates)
            listenToCases();
            listenToSuspects();
            listenToAuditLog();
        }

        async function initializeDefaultData() {
            if (!casesCollectionRef) return;
            // Check if PROXY-001 exists
            const proxyDoc = await getDoc(doc(casesCollectionRef, "PROXY-001"));
            if (!proxyDoc.exists()) {
                console.log("Initializing default case and suspect data...");
                for (const [ref, data] of Object.entries(initialCaseData)) {
                    await setDoc(doc(casesCollectionRef, ref), data);
                }
                for (const [id, data] of Object.entries(initialSuspectsData)) {
                    await setDoc(doc(suspectsCollectionRef, id), data);
                }
            }
        }

        // --- REAL-TIME LISTENERS ---
        
        function listenToCases() {
            onSnapshot(query(casesCollectionRef), (snapshot) => {
                allCases = snapshot.docs.map(d => d.data());
                if (!document.getElementById('main-menu').classList.contains('hidden')) {
                     renderCaseIndex();
                }
            }, (error) => {
                console.error("Error listening to cases:", error);
            });
        }
        
        function listenToSuspects() {
            onSnapshot(query(suspectsCollectionRef), (snapshot) => {
                allSuspects = snapshot.docs.map(d => d.data());
                if (!document.getElementById('records-terminal').classList.contains('hidden')) {
                    renderSuspects();
                }
            }, (error) => {
                console.error("Error listening to suspects:", error);
            });
        }
        
        function listenToAuditLog() {
            const logQuery = query(logCollectionRef, orderBy('timestamp', 'desc'), limit(50));
            onSnapshot(logQuery, (snapshot) => {
                auditLog = snapshot.docs.map(d => ({ ...d.data(), id: d.id }));
                if (!document.getElementById('audit-log-terminal').classList.contains('hidden')) {
                    renderAuditLog();
                }
            }, (error) => {
                console.error("Error listening to audit log:", error);
            });
        }
        
        // --- LOGGING ---
        async function recordAudit(action, details = {}) {
            if (!logCollectionRef) return;
            try {
                await setDoc(doc(logCollectionRef), {
                    timestamp: serverTimestamp(),
                    userId: userId,
                    action: action,
                    details: details,
                });
            } catch (e) {
                console.error("Failed to record audit log:", e);
            }
        }

        function updateSystemLog(message, isError = false) {
            const logElement = document.getElementById('system-log');
            logElement.textContent = message;
            logElement.style.color = isError ? 'var(--color-error)' : 'var(--color-success)';
        }
        
        // --- NAVIGATION & SCREEN MANAGEMENT ---

        function showScreen(screenId) {
            document.querySelectorAll('.terminal-screen, .file-viewer').forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        function setScreenTitle(title) {
            document.getElementById('screen-title').textContent = title;
        }

        // Layer 1: Terminal Access
        window.checkTerminalCode = function(event) {
            // Check only on Enter key or explicit click (though only onkeyup is bound)
            if (event.key === 'Enter' || event.type === 'keyup') {
                const codeInput = document.getElementById('system-code');
                document.getElementById('terminal-message').textContent = '';
                
                if (codeInput.value === SYSTEM_PIN) {
                    updateSystemLog('System Access Granted. Authenticating...');
                    recordAudit("SYSTEM ACCESS", { success: true });
                    codeInput.value = '';
                    initializeFirebaseAndListeners().then(() => {
                        showMainMenu();
                    });
                } else if (codeInput.value.length === 7) {
                    document.getElementById('terminal-message').textContent = 'ACCESS DENIED: Invalid DCI PIN.';
                    updateSystemLog('Access Denied. Invalid PIN.', true);
                    recordAudit("SYSTEM ACCESS", { success: false, pin_attempt: codeInput.value });
                    codeInput.value = '';
                }
            }
        }

        // Expose all navigation functions to the global window object for HTML to use
        window.showMainMenu = function() {
            // Move logo to top right
            document.getElementById('nyp-logo').classList.add('logo-top-right');
            
            setScreenTitle('INVESTIGATION INDEX');
            showScreen('main-menu');
            updateSystemLog('Main Menu: Case Index Loaded. Active User: DCI Jess.W');
            renderCaseIndex();
        }
        window.showRecordsTerminal = function() {
            // Ensure logo is top right
            document.getElementById('nyp-logo').classList.add('logo-top-right');
            
            setScreenTitle('SUSPECT RECORDS');
            showScreen('records-terminal');
            updateSystemLog('Records Terminal Accessed. Real-Time Data Stream Active.');
            renderSuspects();
        }
        window.showAuditLogTerminal = function() {
            // Ensure logo is top right
            document.getElementById('nyp-logo').classList.add('logo-top-right');
            
            setScreenTitle('SYSTEM AUDIT LOG');
            showScreen('audit-log-terminal');
            updateSystemLog('Audit Log Terminal Accessed. Real-Time Data Stream Active.');
            renderAuditLog();
        }

        // --- RENDERING FUNCTIONS (Called by Listeners) ---
        
        function renderCaseIndex() {
            const grid = document.getElementById('case-grid');
            grid.innerHTML = '';
            allCases.forEach(caseItem => {
                const statusClass = caseItem.status.includes('Active') ? 'status-active' : 'status-closed';
                const card = document.createElement('div');
                card.className = 'case-card';
                card.onclick = () => window.showCaseLogin(caseItem.ref);
                
                card.innerHTML = `
                    <h4>${caseItem.name}</h4>
                    <p><strong>Ref:</strong> ${caseItem.ref}</p>
                    <p><strong>Officer:</strong> ${caseItem.officer}</p>
                    <p><strong>Status:</strong> <span class="${statusClass}">${caseItem.status.toUpperCase()}</span></p>
                `;
                grid.appendChild(card);
            });
        }
        
        function renderSuspects() {
            const grid = document.getElementById('records-grid');
            grid.innerHTML = '';
            
            allSuspects.forEach(suspect => {
                const statusClass = suspect.status.includes('POI') ? 'status-unconfirmed' : 'status-active';
                const card = document.createElement('div');
                card.className = 'record-card';
                
                card.innerHTML = `
                    <h4>${suspect.name} (${suspect.ref})</h4>
                    <p><strong>Alias:</strong> ${suspect.alias}</p>
                    <p><strong>Location:</strong> ${suspect.currentLocation}</p>
                    <p><strong>Status:</strong> <span class="${statusClass}">${suspect.status.toUpperCase()}</span></p>
                    <p><strong>Linked Cases:</strong> ${suspect.linkedCases.join(', ')}</p>
                `;
                grid.appendChild(card);
            });
        }

        function renderAuditLog() {
            const logContent = document.getElementById('audit-log-content');
            if (auditLog.length === 0) {
                logContent.innerHTML = '<p style="color:var(--color-accent);">No recent activity recorded.</p>';
                return;
            }

            logContent.innerHTML = auditLog.map(log => {
                const timestamp = log.timestamp ? new Date(log.timestamp.toDate()).toLocaleString('en-GB', { 
                    year: 'numeric', month: '2-digit', day: '2-digit', 
                    hour: '2-digit', minute: '2-digit', second: '2-digit' 
                }) : 'N/A';
                
                let message = `${log.action}`;
                if (log.details.success !== undefined) {
                    message += log.details.success ? " [SUCCESS]" : " [FAILURE]";
                }

                return `
                    <div class="log-entry">
                        <span>${timestamp}</span>
                        <span>${message}</span>
                    </div>
                `;
            }).join('');
        }
        
        // --- AUTH/CASE FILE ACCESS ---

        window.showCaseLogin = function(caseRef) {
            // Using a simple prompt for the password to maintain the high security friction
            const password = prompt(`Case File ${caseRef} requires password access. Enter password:`);
            if (password === CASE_PASSWORDS[caseRef]) {
                renderCaseFile(caseRef);
                showScreen('case-file-viewer');
                setScreenTitle(`CASE FILE: ${caseRef}`);
                recordAudit("FILE ACCESS", { case: caseRef, success: true });
            } else if (password !== null) {
                updateSystemLog(`Access Denied to ${caseRef}.`, true);
                recordAudit("FILE ACCESS", { case: caseRef, success: false });
                window.alert("ACCESS DENIED: Incorrect password. Logging attempt recorded.");
            }
        }

        // Layer 5: Case File Viewer
        function renderCaseFile(caseRef) {
            const activeCase = allCases.find(c => c.ref === caseRef);
            if (!activeCase) {
                document.getElementById('file-content').innerHTML = `<p class="error">Case file ${caseRef} not found in database.</p>`;
                return;
            }

            // Update Header
            document.getElementById('file-ref-display').textContent = activeCase.ref;
            document.getElementById('file-status-display').textContent = activeCase.status.toUpperCase();
            document.getElementById('file-officer-display').textContent = activeCase.officer;

            // Render Content
            const contentElement = document.getElementById('file-content');
            contentElement.innerHTML = '';
            
            activeCase.sections.forEach(section => {
                let htmlContent = `<h3>${section.title}</h3>`;
                htmlContent += section.content || '';
                contentElement.innerHTML += htmlContent;
            });
        }
        
        window.logOutUser = function() {
            // NOTE: Replaced standard confirm() with window.confirm() to align with system security aesthetics.
            const userConfirms = window.confirm("SECURITY WARNING: Are you sure you want to log out and terminate the secure session? This action is logged.");
            if (userConfirms) {
                signOut(auth).then(() => {
                    recordAudit("SESSION END", { success: true });
                    window.location.reload(); // Hard reload to reset state and force PIN screen
                }).catch(error => {
                    console.error("Logout failed:", error);
                    updateSystemLog('Logout Failed.', true);
                });
            }
        }

        // --- UTILITY ---
        function updateTime() {
            const timeElement = document.getElementById('current-time');
            if (timeElement) {
                 const now = new Date();
                 // ÖestVèl Somir tiè (OVST) is equivalent to CEST (UTC+2)
                 const ovstOffset = 2;
                 const localUtc = now.getTime() + (now.getTimezoneOffset() * 60000);
                 const ovstTime = new Date(localUtc + (3600000 * ovstOffset));

                const formattedTime = ovstTime.toLocaleTimeString('en-GB', {
                    year: 'numeric', month: '2-digit', day: '2-digit',
                    hour: '2-digit', minute: '2-digit', second: '2-digit',
                    hour12: false
                }).replace(',', ' ') + ' OVST'; 
                timeElement.textContent = formattedTime;
            }
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
             // System log starts here, awaiting user input.
             updateSystemLog('SYSTEM OFFLINE. AWAITING DCI PIN.');
        });
        
        updateTime();
        setInterval(updateTime, 1000);

    </script>
</body>
</html>

